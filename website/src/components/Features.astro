---
import AtLeastOnce from "./Features/AtLeastOnce.astro";
import Topics from "./Features/Topics.astro";
import Retry from "./Features/Retry.astro";
import Publish from "./Features/Publish.astro";
import MultiTenant from "./Features/MultiTenant.astro";
import Portal from "./Features/Portal.astro";
import OpenTelemetry from "./Features/OpenTelemetry.astro";
import BestPractices from "./Features/BestPractices.astro";
import Alert from "./Features/Alert.astro";
---

<section>
  <h2 class="bold-2xl">Features</h2>
  <div class="feature-grid">
    <div class="feature-item item-1">
      <AtLeastOnce />
      <div class="feature-item-content">
        <h3 class="bold-m">At-least-once delivery guarantee</h3>
        <p class="regular-m sans-serif">
          Messages are guaranteed to be delivered at least once and are never
          lost.
        </p>
      </div>
    </div>
    <div class="feature-item item-2">
      <div class="feature-item-content">
        <h3 class="bold-m">Topic-based subscriptions</h3>
        <p class="regular-m sans-serif">
          Supports the common publish and subscription paradigm to ease adoption
          and integration into existing systems.
        </p>
      </div>
      <Topics />
    </div>
    <div class="feature-item item-3">
      <Retry />
      <div class="feature-item-content">
        <h3 class="bold-m">Automatic and manual retries</h3>
        <p class="regular-m sans-serif">
          Configure automatic retries or manually trigger them via our API or
          user portal.
        </p>
      </div>
    </div>
    <div class="feature-item item-4">
      <div class="feature-item-content">
        <h3 class="bold-m">Publish events via API or queue</h3>
        <p class="regular-m sans-serif">
          Publish events using the Outpost API or configure Outpost to read
          events from a publish queue.
        </p>
      </div>
      <Publish />
    </div>
    <div class="feature-item item-5">
      <MultiTenant />
      <div class="feature-item-content">
        <h3 class="bold-m">Multi-tenant support</h3>
        <p class="regular-m sans-serif">
          Create multiple tenants on a single Outpost deployment.
        </p>
      </div>
    </div>
    <div class="feature-item item-6">
      <div class="feature-item-content">
        <h3 class="bold-m">User portal</h3>
        <p class="regular-m sans-serif">
          With Outpost, developers can view metrics, manage, debug, and observe
          their event destinations.
        </p>
      </div>
      <Portal />
    </div>
    <div class="feature-item item-7">
      <OpenTelemetry />
      <div class="feature-item-content">
        <h3 class="bold-m">OpenTelemetry</h3>
        <p class="regular-m sans-serif">
          Outpost features OpenTelemetry standardized traces, metrics, and logs.
        </p>
      </div>
    </div>
    <div class="feature-item item-8">
      <BestPractices />
      <div class="feature-item-content">
        <h3 class="bold-m">Webhook best practices, by default</h3>
        <p class="regular-m sans-serif">
          Opt-out idempotency headers, timestamp and signature, and signature
          rotation.
        </p>
      </div>
    </div>
    <div class="feature-item item-9">
      <Alert />
      <div class="feature-item-content">
        <h3 class="bold-m">User alerts</h3>
        <p class="regular-m sans-serif">
          Grant developers the ability to configure and manage event delivery
          alerts.
        </p>
      </div>
    </div>
  </div>
</section>

<style>
  section {
    margin: var(--spacing-20) auto;
  }

  h2 {
    margin-top: 0;
    margin-bottom: var(--spacing-8);
  }

  h3 {
    margin: 0;
  }

  p {
    margin: 0;
    color: var(--foreground-neutral-2);
  }

  .feature-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-auto-rows: minmax(200px, auto);
    border: 1px solid var(--outline-neutral);
  }

  .feature-item-content {
    padding: var(--spacing-8);
  }

  .feature-item {
    border-right: 1px solid var(--outline-neutral);
    border-bottom: 1px solid var(--outline-neutral);
    display: flex;
    flex-direction: column;
    height: 100%;
    overflow: hidden;
  }

  /* Remove right border from last column */
  .feature-item:nth-child(3n) {
    border-right: none;
  }

  /* Remove bottom border from last row */
  .feature-item:nth-last-child(-n + 3) {
    border-bottom: none;
  }

  /* Define specific grid positions for each item */
  .item-1 {
    grid-column: 1 / 2; /* 1x1 */
    grid-row: 1 / 2;
  }

  .item-2 {
    grid-column: 2 / 3; /* 1x2 */
    grid-row: 1 / 3;
  }

  .item-3 {
    grid-column: 3 / 4; /* 1x1 */
    grid-row: 1 / 2;
  }

  .item-4 {
    grid-column: 1 / 2; /* 1x2 */
    grid-row: 2 / 4;
  }

  .item-5 {
    grid-column: 2 / 3; /* 1x1 */
    grid-row: 3 / 4;
  }

  .item-6 {
    grid-column: 3 / 4; /* 1x2 */
    grid-row: 2 / 4;
  }

  .item-7 {
    grid-column: 1 / 2; /* 1x1 */
    grid-row: 4 / 5;
  }

  .item-8 {
    grid-column: 2 / 3; /* 1x1 */
    grid-row: 4 / 5;
  }

  .item-9 {
    grid-column: 3 / 4; /* 1x1 */
    grid-row: 4 / 5;
  }

  @media (max-width: 1334px) {
    .feature-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    /* Reset and fix borders for 2-column layout */
    .feature-item:nth-child(3n) {
      border-right: 1px solid var(--outline-neutral);
    }

    .feature-item:nth-child(even) {
      border-right: none;
    }

    .feature-item:nth-last-child(-n + 3) {
      border-bottom: 1px solid var(--outline-neutral);
    }
    /* Update last row border rules */
    .item-8 {
      border-right: 1px solid var(--outline-neutral);
    }
    .item-8,
    .item-9 {
      border-bottom: none;
    }

    /* Redefine grid positions for 2-column layout */
    .item-1 {
      grid-column: 1 / 2;
      grid-row: 1 / 2;
    }
    .item-2 {
      grid-column: 2 / 3;
      grid-row: 1 / 3; /* 1x2 */
    }
    .item-3 {
      grid-column: 2 / 3;
      grid-row: 3 / 4;
      border-right: none !important;
    }
    .item-4 {
      grid-column: 1 / 2;
      grid-row: 2 / 4; /* 1x2 */
      border-right: 1px solid var(--outline-neutral) !important;
    }
    .item-5 {
      grid-column: 1 / 2;
      grid-row: 4 / 5;
    }
    .item-6 {
      grid-column: 2 / 3;
      grid-row: 4 / 6; /* 1x2 */
    }
    .item-7 {
      grid-column: 1 / 2;
      grid-row: 5 / 6;
    }
    .item-8 {
      grid-column: 1 / 2;
      grid-row: 6 / 7;
      border-right: 1px solid var(--outline-neutral) !important;
    }
    .item-9 {
      grid-column: 2 / 3;
      grid-row: 6 / 7;
      border-right: none !important;
    }
  }

  @media (max-width: 744px) {
    .feature-grid {
      grid-template-columns: 1fr;
    }

    /* Reset borders for single column */
    .feature-item {
      border-right: none !important;
      border-left: none !important;
      border-bottom: 1px solid var(--outline-neutral) !important;
    }
    
    .feature-item:last-child {
      border-bottom: none !important;
    }

    /* Reset and set all grid positions for single column */
    .item-1 {
      grid-column: 1;
      grid-row: auto;
    }
    .item-2 {
      grid-column: 1;
      grid-row: span 2;
    }
    .item-3 {
      grid-column: 1;
      grid-row: auto;
    }
    .item-4 {
      grid-column: 1;
      grid-row: span 2;
    }
    .item-5 {
      grid-column: 1;
      grid-row: auto;
    }
    .item-6 {
      grid-column: 1;
      grid-row: span 2;
    }
    .item-7 {
      grid-column: 1;
      grid-row: auto;
    }
    .item-8 {
      grid-column: 1;
      grid-row: auto;
    }
    .item-9 {
      grid-column: 1;
      grid-row: auto;
    }
  }
</style>
